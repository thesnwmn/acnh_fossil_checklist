<html>
    <head>

        <title>ACNH Fossil Checklist</title>

        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

        <style>

            .spacer {
                height: 70px;
                content: "";
            }
        
            body {
                min-width: 300px;   
                width: auto !important;
            }
            
            li > .form-checkbox {
                margin-left: 2em;
            }

            .form-label {
                margin-left: 1em;
                margin-bottom: 0;
            }

            footer {
                position: fixed;
                bottom: 0;
                width: 100%;
            }
        </style>

    </head>
    <body>
        <nav class="navbar navbar-expand-md navbar-dark bg-light fixed-top bg-dark">
            <a class="navbar-brand" href="#">Fossils</a>
        </nav>
        <div class="spacer"></div>
        <div class="container" id='content'></div>
        <footer id='footer' class="footer bg-secondary text-white invisible">
            <div class="container py-3">
                <div>
                    This site uses local storage to record your fossil selections between visits.
                    All data is kept on your device and never transmitted to a remote location.
                    Rejecting will reduce funtionality of the site.
                </div>
                <div class="mt-3">
                    <button type="button" class="btn btn-success" onclick="acceptStorage()">Accept</button>
                    <button type="button" class="btn btn-dark ml-1" onclick="rejectStorage()">Reject</button>
                </div>
            </div>
        </footer>

        <!-- Optional JavaScript -->
        <!-- jQuery first, then Popper.js, then Bootstrap JS -->
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
      
        <script>

            function titleChanged(e, groupId) {
                var parts = document.querySelectorAll('.js-part.js-group-' + groupId);
                if (parts.length > 0) {
                    parts.forEach(function(part) {
                        part.checked = e.target.checked;
                    });
                }
                updateStorage();
            }

            function partChanged(e, groupId) {
                var title = document.querySelector('.js-title.js-group-' + groupId);
                if (e.target.checked !== true) {
                    title.checked = false;
                } else {
                    var allChecked = true;
                    document.querySelectorAll('.js-part.js-group-' + groupId).forEach(function(part) {
                        if (part.checked !== true) {
                            allChecked = false;
                        }
                    });
                    title.checked = allChecked;
                }
                updateStorage();
            }

            function drawStorage() {
                var fossils = retrieveFossils();
                document.querySelectorAll('.js-title.js-no-parts').forEach(function(checkbox) {
                    if (fossils.indexOf(checkbox.id) !== -1) {
                        checkbox.checked = true;
                    }
                });
                document.querySelectorAll('.js-part').forEach(function(checkbox) {
                    if (fossils.indexOf(checkbox.id) !== -1) {
                        checkbox.checked = true;
                    }
                });
                document.querySelectorAll('.js-title.js-has-parts').forEach(function(title) {
                    var allChecked = true;
                    var parts = document.querySelectorAll('.js-part.js-group-' + title.id);
                    if (parts.length > 0) {
                        parts.forEach(function(part) {
                            if (part.checked !== true) {
                                allChecked = false;
                            }
                        });
                    }
                    title.checked = allChecked;
                });
            }

            function updateStorage() {
                if (hasAcceptedStorage()) {
                    var data = [];
                    document.querySelectorAll('.js-title.js-no-parts').forEach(function(title) {
                        if (title.checked === true) {
                            data.push(title.id);
                        }
                    });
                    document.querySelectorAll('.js-part').forEach(function(part) {
                        if (part.checked === true) {
                            data.push(part.id);
                        }
                    });
                    storeFossils(data);
                }
            }

            /**
             * Display updates
             */

            function drawTitle(group, hasParts) {

                var body, form, label, checkbox;

                checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = group.id;
                checkbox.classList.add('form-checkbox', 'js-title', 'js-group-' + group.id, hasParts ? 'js-has-parts' : 'js-no-parts');

                label = document.createElement('label');
                label.textContent = group.en;
                label.htmlFor = group.id;
                label.classList.add('form-label', 'font-weight-bold');

                body = document.createElement('div');
                body.classList.add('card-header');
                body.appendChild(checkbox);
                body.appendChild(label);

                checkbox.onchange = function(e) {
                    titleChanged(e, group.id);
                };

                return body;
            }

            function drawPart(groupId, part) {

                var li, label, checkbox;

                checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = part.id;
                checkbox.classList.add('form-checkbox', 'js-part', 'js-group-' + groupId);

                label = document.createElement('label');
                label.textContent = part.en;
                label.htmlFor = part.id;
                label.classList.add('form-label');

                li = document.createElement('li');
                li.classList.add('list-group-item');
                li.appendChild(checkbox);
                li.appendChild(label);

                checkbox.onchange = function(e) {
                    partChanged(e, groupId);
                };

                return li;
            }

            function drawCard(fossil) {

                var card, ul;

                card = document.createElement('div');
                card.classList.add('card', 'm-3');
                card.appendChild(drawTitle(fossil, typeof fossil.parts !== 'undefined'));
                
                if (typeof fossil.parts !== 'undefined') {

                    ul = document.createElement('ul');
                    ul.classList.add('list-group', 'list-group-flush');

                    fossil.parts.forEach(function(part) {
                        ul.appendChild(drawPart(fossil.id, part));
                    });

                    card.appendChild(ul);
                }

                return card;
            }

            function drawDisplay() {

                var container = document.getElementById('content');
                container.innerHTML = '';

                FOSSILS.forEach(function(fossil) {
                    container.appendChild(drawCard(fossil));
                })
            }

            /**
             * Storage functions
             */

            function hideStoragePrompt() {
                document.getElementById('footer').classList.add('invisible');
            }

            function showStoragePrompt() {
                document.getElementById('footer').classList.remove('invisible');
            }

            function acceptStorage() {
                window.localStorage.setItem('accepted_storage', 'true');
                updateStorage();
                hideStoragePrompt();
            }

            function rejectStorage() {
                window.localStorage.clear();
                hideStoragePrompt();
            }

            function hasAcceptedStorage() {
                return window.localStorage.getItem('accepted_storage') === 'true';
            }

            function storeFossils(parts) {
                if (hasAcceptedStorage()) {
                    window.localStorage.setItem('fossils', JSON.stringify(parts));
                }
            }

            function retrieveFossils() {
                var result;
                if (hasAcceptedStorage()) {
                    result = JSON.parse(window.localStorage.getItem('fossils'));
                }
                if (typeof result === 'undefined' || result === null) {
                    result = [];
                }
                return result;
            }

            /**
             * Initialisation
             */

            window.onload = function() {

                drawDisplay();

                if (hasAcceptedStorage()) {
                    hideStoragePrompt();
                    drawStorage();
                } else {
                    showStoragePrompt();
                }
            };
            
            var FOSSILS = [
                {
                    id: "1",
                    en: "Acanthostega"
                },
                {
                    id: "2",
                    en: "Amber"
                },
                {
                    id: "3",
                    en: "Ammonite"
                },
                {
                    id: "4",
                    en: "Ankylosaurus",
                    parts: [{
                        id: "4-1",
                        en: "Ankylo skull"
                    }, {
                        id: "4-2",
                        en: "Ankylo torso"
                    }, {
                        id: "4-3",
                        en: "Ankylo tail"
                    }]
                },
                {
                    id: "5",
                    en: "Anomalocaris"
                },
                {
                    id: "6",
                    en: "Archaeopteryx"
                },
                {
                    id: "7",
                    en: "Archelon",
                    parts: [{
                        id: "7-1",
                        en: "Archelon skull"
                    }, {
                        id: "7-2",
                        en: "Archelon tail"
                    }]
                },
                {
                    id: "8",
                    en: "Australopith"
                },
                {
                    id: "9",
                    en: "Brachiosaurus",
                    parts: [{
                        id: "9-1",
                        en: "Branchio skull"
                    }, {
                        id: "9-2",
                        en: "Brachio chest"
                    }, {
                        id: "9-3",
                        en: "Brachio pelvis"
                    }, {
                        id: "9-4",
                        en: "Brachio tail"
                    }]
                },
                {
                    id: "10",
                    en: "Corprolite"
                },
                {
                    id: "11",
                    en: "Deinonychus",
                    parts: [{
                        id: "11-1",
                        en: "Deinony torso"
                    }, {
                        id: "11-2",
                        en: "Deinony tail"
                    }]
                },
                {
                    id: "12",
                    en: "Dimetrodon",
                    parts: [{
                        id: "12-1",
                        en: "Dimetrodon skull"
                    }, {
                        id: "12-2",
                        en: "Dimetrodon torso"
                    }, {
                        id: "12-3",
                        en: "Dimetrodon tail"
                    }]
                },
                {
                    id: "13",
                    en: "Dinosaur Track"
                },
                {
                    id: "14",
                    en: "Diplodocus",
                    parts: [{
                        id: "14-1",
                        en: "Diplo skull"
                    }, {
                        id: "14-2",
                        en: "Diplo neck"
                    }, {
                        id: "14-3",
                        en: "Diplo chest"
                    }, {
                        id: "14-4",
                        en: "Diplo pelvis"
                    }, {
                        id: "14-5",
                        en: "Diplo tail"
                    }, {
                        id: "14-6",
                        en: "Diplo tail tip"
                    }]
                },
                {
                    id: "15",
                    en: "Dunkleosteus"
                },
                {
                    id: "16",
                    en: "Eusthenopteron"
                },
                {
                    id: "17",
                    en: "Iguanodon",
                    parts: [{
                        id: "17-1",
                        en: "Iguanodon skull"
                    }, {
                        id: "17-2",
                        en: "Iguanodon torso"
                    }, {
                        id: "17-3",
                        en: "Iguanodon tail"
                    }]
                },
                {
                    id: "18",
                    en: "Juramaia"
                },
                {
                    id: "19",
                    en: "Mammoth",
                    parts: [{
                        id: "19-1",
                        en: "Mammoth skull"
                    }, {
                        id: "19-2",
                        en: "Mammoth torso"
                    }]
                },
                {
                    id: "20",
                    en: "Megacerops",
                    parts: [{
                        id: "20-1",
                        en: "Megacero skull"
                    }, {
                        id: "20-2",
                        en: "Megacero torso"
                    }, {
                        id: "20-3",
                        en: "Megacero tail"
                    }]
                },
                {
                    id: "21",
                    en: "Megaloceros",
                    parts: [{
                        id: "21-1",
                        en: "Megalo left side"
                    }, {
                        id: "21-2",
                        en: "Megalo right side"
                    }]
                },
                {
                    id: "22",
                    en: "Myllokumingia"
                },
                {
                    id: "23",
                    en: "Ophthalmosaurus",
                    parts: [{
                        id: "23-1",
                        en: "Ophthalmo skull"
                    }, {
                        id: "23-2",
                        en: "Ophthalmo torso"
                    }, {
                        id: "23-3",
                        en: "Ophthalmo tail"
                    }]
                },
                {
                    id: "24",
                    en: "Pachycephalosaurus",
                    parts: [{
                        id: "24-1",
                        en: "Pachy skull"
                    }, {
                        id: "24-2",
                        en: "Pachy torso"
                    }, {
                        id: "24-3",
                        en: "Pachy tail"
                    }]
                },
                {
                    id: "25",
                    en: "Parasaurolophus",
                    parts: [{
                        id: "25-1",
                        en: "Parasaur skull"
                    }, {
                        id: "25-2",
                        en: "Parasaur torso"
                    }, {
                        id: "25-3",
                        en: "Parasaur tail"
                    }]
                },
                {
                    id: "26",
                    en: "Plesiosaurus",
                    parts: [{
                        id: "26-1",
                        en: "Plesio skull"
                    }, {
                        id: "26-2",
                        en: "Plesio body",
                    }, {
                        id: "26-3",
                        en: "Plesio tail"
                    }]
                },
                {
                    id: "27",
                    en: "Pteranodon",
                    parts: [{
                        id: "27-1",
                        en: "Ptera body"
                    }, {
                        id: "27-2",
                        en: "Left ptera wing"
                    }, {
                        id: "27-3",
                        en: "Right ptera wing"
                    }]
                },
                {
                    id: "28",
                    en: "Quetzalcoatlus",
                    parts: [{
                        id: "28-1",
                        en: "Quetzal torso"
                    }, {
                        id: "28-2",
                        en: "Left quetzal wing"
                    }, {
                        id: "28-3",
                        en: "Right quetzal wing"
                    }]
                },
                {
                    id: "29",
                    en: "Sabertooth Tiger",
                    parts: [{
                        id: "29-1",
                        en: "Sabertooth skull"
                    }, {
                        id: "29-2",
                        en: "Sabertooth torso"
                    }]
                },
                {
                    id: "30",
                    en: "Shark-Tooth Pattern"
                },
                {
                    id: "31",
                    en: "Spinosaurus",
                    parts: [{
                        id: "31-1",
                        en: "Spino skull"
                    }, {
                        id: "31-2",
                        en: "Spino torso"
                    }, {
                        id: "31-3",
                        en: "Spino tail"
                    }]
                },
                {
                    id: "32",
                    en: "Stegosaurus",
                    parts: [{
                        id: "32-1",
                        en: "Stego skull"
                    }, {
                        id: "32-2",
                        en: "Stego torso"
                    }, {
                        id: "32-3",
                        en: "Stego tail"
                    }]
                },
                {
                    id: "33",
                    en: "Tyrannosaurus Rex",
                    parts: [{
                        id: "33-1",
                        en: "T. Rex skull"
                    }, {
                        id: "33-2",
                        en: "T. Rex torso"
                    }, {
                        id: "33-3",
                        en: "T. Rex tail"
                    }]
                },
                {
                    id: "34",
                    en: "Triceratops",
                    parts: [{
                        id: "34-1",
                        en: "Tricera skull"
                    }, {
                        id: "34-2",
                        en: "Tricera torso"
                    }, {
                        id: "34-3",
                        en: "Tricera tail"
                    }]
                }
            ];
        </script>
    </body>
</html>
